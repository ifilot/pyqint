

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Geometry optimization &mdash; PyQInt  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=ede6f590" />
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Population Analysis" href="population_analysis.html" />
    <link rel="prev" title="Matrix visualization" href="matrix_visualization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PyQInt
              <img src="_static/pyqint_logo_128.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basis_functions.html">Basis functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="integral_evaluation.html">Integral evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basis_sets_and_molecules.html">Basis sets and molecules</a></li>
<li class="toctree-l1"><a class="reference internal" href="electronic_structure_calculations.html">Electronic structure calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="molecular_orbital_diagrams.html">Molecular Orbital Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="orbital_visualization.html">Orbital visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="orbital_localization.html">Orbital localization: Foster-Boys</a></li>
<li class="toctree-l1"><a class="reference internal" href="matrix_visualization.html">Matrix visualization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Geometry optimization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#performing-a-geometry-optimization">Performing a geometry optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#result-dictionary-of-a-geometry-optimization">Result dictionary of a geometry optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="population_analysis.html">Population Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="symmetry_adapted_basis.html">Symmetry-adapted basis sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="acceleration_routines.html">Integral evaluation acceleration routines</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrator.html">Integrator object</a></li>
<li class="toctree-l1"><a class="reference internal" href="gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="community_guidelines.html">Community guidelines</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyQInt</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div style="text-align: right;">
<a href="https://github.com/ifilot/pyqint" target="_blank"><i class="fa-brands fa-github"></i> Github</a>
</div>
<hr>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="geometry-optimization">
<span id="index-0"></span><h1><a class="toc-backref" href="#id4" role="doc-backlink">Geometry optimization</a><a class="headerlink" href="#geometry-optimization" title="Link to this heading"></a></h1>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#geometry-optimization" id="id4">Geometry optimization</a></p>
<ul>
<li><p><a class="reference internal" href="#performing-a-geometry-optimization" id="id5">Performing a geometry optimization</a></p></li>
<li><p><a class="reference internal" href="#result-dictionary-of-a-geometry-optimization" id="id6">Result dictionary of a geometry optimization</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="performing-a-geometry-optimization">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Performing a geometry optimization</a><a class="headerlink" href="#performing-a-geometry-optimization" title="Link to this heading"></a></h2>
<p><strong class="program">PyQInt</strong> is able to perform a geometry optimization of a molecule. It
should however be noted that this functionality is rather limited and essentially
makes use of existing routines available in <a class="reference external" href="https://scipy.org/">Scipy</a>,
specifically the <code class="code docutils literal notranslate"><span class="pre">scipy.optimize.minimize</span></code> routine using the
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.minimize-cg.html">conjugate gradient</a> method.</p>
<p>To demonstrate the procedure, let us consider the CH<sub>4</sub> molecule in a
non-converged geometry wherein the C-H bonds are longer than their optimal
value and where the C molecule does not lie in the middle of the 4 hydrogen
atoms.</p>
<p>Geometry optimization is handled by the <code class="code docutils literal notranslate"><span class="pre">GeometryOptimization</span></code> class
which takes a molecule and a basis set as input. The user can indicate whether
they prefer verbose output or not. By default, geometry optimization is <em>silent</em>
and does not yield any output.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyqint</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeometryOptimization</span><span class="p">,</span> <span class="n">Molecule</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">dist</span><span class="p">,</span> <span class="o">-</span><span class="n">dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="o">-</span><span class="n">dist</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="o">-</span><span class="n">dist</span><span class="p">,</span> <span class="o">-</span><span class="n">dist</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">GeometryOptimization</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;sto3g&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The output of the above script (condensed) is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">################################################################################</span>
<span class="n">START</span> <span class="n">GEOMETRY</span> <span class="n">OPTIMIZATION</span> <span class="p">(</span><span class="n">CONJUGATE</span> <span class="n">GRADIENT</span><span class="p">)</span>
<span class="c1">################################################################################</span>

<span class="o">================================================================================</span>
<span class="n">GEOMETRY</span> <span class="n">OPTIMIZATION</span> <span class="n">STEP</span> <span class="mi">001</span>
<span class="o">================================================================================</span>

<span class="o">--------------------------------------------------------------------------------</span>
    <span class="n">ENERGIES</span>
<span class="o">--------------------------------------------------------------------------------</span>

<span class="n">Kinetic</span><span class="p">:</span>                      <span class="mf">39.25313761</span>
<span class="n">Nuclear</span><span class="p">:</span>                     <span class="o">-</span><span class="mf">108.88180088</span>
<span class="n">Electron</span><span class="o">-</span><span class="n">electron</span> <span class="n">repulsion</span><span class="p">:</span>  <span class="mf">28.15082009</span>
<span class="n">Exchange</span><span class="p">:</span>                     <span class="o">-</span><span class="mf">6.09926245</span>
<span class="n">Nuclear</span> <span class="n">repulsion</span><span class="p">:</span>             <span class="mf">8.45508042</span>
<span class="n">TOTAL</span><span class="p">:</span>                       <span class="o">-</span><span class="mf">39.12202512</span>

<span class="o">--------------------------------------------------------------------------------</span>
    <span class="n">POSITIONS</span> <span class="n">AND</span> <span class="n">FORCES</span>
<span class="o">--------------------------------------------------------------------------------</span>

<span class="n">C</span>  <span class="o">|</span>   <span class="mf">0.100000</span>   <span class="mf">0.000000</span>   <span class="mf">0.100000</span> <span class="o">|</span> <span class="o">+</span><span class="mf">1.6500e-02</span> <span class="o">+</span><span class="mf">2.2923e-04</span> <span class="o">+</span><span class="mf">1.6500e-02</span>
<span class="n">H</span>  <span class="o">|</span>   <span class="mf">1.000000</span>   <span class="mf">1.000000</span>   <span class="mf">1.000000</span> <span class="o">|</span> <span class="o">+</span><span class="mf">4.3454e-02</span> <span class="o">+</span><span class="mf">5.0855e-02</span> <span class="o">+</span><span class="mf">4.3454e-02</span>
<span class="n">H</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">1.000000</span>  <span class="o">-</span><span class="mf">1.000000</span>   <span class="mf">1.000000</span> <span class="o">|</span> <span class="o">-</span><span class="mf">5.2300e-02</span> <span class="o">-</span><span class="mf">4.5705e-02</span> <span class="o">+</span><span class="mf">3.8773e-02</span>
<span class="n">H</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">1.000000</span>   <span class="mf">1.000000</span>  <span class="o">-</span><span class="mf">1.000000</span> <span class="o">|</span> <span class="o">-</span><span class="mf">4.6427e-02</span> <span class="o">+</span><span class="mf">4.0325e-02</span> <span class="o">-</span><span class="mf">4.6427e-02</span>
<span class="n">H</span>  <span class="o">|</span>   <span class="mf">1.000000</span>  <span class="o">-</span><span class="mf">1.000000</span>  <span class="o">-</span><span class="mf">1.000000</span> <span class="o">|</span> <span class="o">+</span><span class="mf">3.8773e-02</span> <span class="o">-</span><span class="mf">4.5705e-02</span> <span class="o">-</span><span class="mf">5.2300e-02</span>

<span class="n">Elapsed</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.2787</span> <span class="n">s</span>

<span class="o">================================================================================</span>

<span class="o">================================================================================</span>
<span class="n">GEOMETRY</span> <span class="n">OPTIMIZATION</span> <span class="n">STEP</span> <span class="mi">002</span>
<span class="o">================================================================================</span>

<span class="o">--------------------------------------------------------------------------------</span>
    <span class="n">ENERGIES</span>
<span class="o">--------------------------------------------------------------------------------</span>

<span class="n">Kinetic</span><span class="p">:</span>                      <span class="mf">39.15432005</span>
<span class="n">Nuclear</span><span class="p">:</span>                     <span class="o">-</span><span class="mf">109.64153523</span>
<span class="n">Electron</span><span class="o">-</span><span class="n">electron</span> <span class="n">repulsion</span><span class="p">:</span>  <span class="mf">28.55699241</span>
<span class="n">Exchange</span><span class="p">:</span>                     <span class="o">-</span><span class="mf">6.14351258</span>
<span class="n">Nuclear</span> <span class="n">repulsion</span><span class="p">:</span>             <span class="mf">8.85933154</span>
<span class="n">TOTAL</span><span class="p">:</span>                       <span class="o">-</span><span class="mf">39.21440452</span>

<span class="o">--------------------------------------------------------------------------------</span>
    <span class="n">POSITIONS</span> <span class="n">AND</span> <span class="n">FORCES</span>
<span class="o">--------------------------------------------------------------------------------</span>

<span class="n">C</span>  <span class="o">|</span>   <span class="mf">0.083500</span>  <span class="o">-</span><span class="mf">0.000229</span>   <span class="mf">0.083500</span> <span class="o">|</span> <span class="o">+</span><span class="mf">1.5463e-02</span> <span class="o">+</span><span class="mf">6.8533e-04</span> <span class="o">+</span><span class="mf">1.5463e-02</span>
<span class="n">H</span>  <span class="o">|</span>   <span class="mf">0.956546</span>   <span class="mf">0.949145</span>   <span class="mf">0.956546</span> <span class="o">|</span> <span class="o">+</span><span class="mf">4.4324e-02</span> <span class="o">+</span><span class="mf">5.0368e-02</span> <span class="o">+</span><span class="mf">4.4324e-02</span>
<span class="n">H</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">0.947700</span>  <span class="o">-</span><span class="mf">0.954295</span>   <span class="mf">0.961227</span> <span class="o">|</span> <span class="o">-</span><span class="mf">5.2664e-02</span> <span class="o">-</span><span class="mf">4.7060e-02</span> <span class="o">+</span><span class="mf">4.1251e-02</span>
<span class="n">H</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">0.953573</span>   <span class="mf">0.959675</span>  <span class="o">-</span><span class="mf">0.953573</span> <span class="o">|</span> <span class="o">-</span><span class="mf">4.8374e-02</span> <span class="o">+</span><span class="mf">4.3066e-02</span> <span class="o">-</span><span class="mf">4.8374e-02</span>
<span class="n">H</span>  <span class="o">|</span>   <span class="mf">0.961227</span>  <span class="o">-</span><span class="mf">0.954295</span>  <span class="o">-</span><span class="mf">0.947700</span> <span class="o">|</span> <span class="o">+</span><span class="mf">4.1251e-02</span> <span class="o">-</span><span class="mf">4.7060e-02</span> <span class="o">-</span><span class="mf">5.2664e-02</span>

<span class="n">Elapsed</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.2461</span> <span class="n">s</span>

<span class="o">================================================================================</span>

<span class="o">...</span>

<span class="o">================================================================================</span>
<span class="n">GEOMETRY</span> <span class="n">OPTIMIZATION</span> <span class="n">STEP</span> <span class="mi">033</span>
<span class="o">================================================================================</span>

<span class="o">--------------------------------------------------------------------------------</span>
    <span class="n">ENERGIES</span>
<span class="o">--------------------------------------------------------------------------------</span>

<span class="n">Kinetic</span><span class="p">:</span>                      <span class="mf">39.46555789</span>
<span class="n">Nuclear</span><span class="p">:</span>                     <span class="o">-</span><span class="mf">118.95694319</span>
<span class="n">Electron</span><span class="o">-</span><span class="n">electron</span> <span class="n">repulsion</span><span class="p">:</span>  <span class="mf">32.86550181</span>
<span class="n">Exchange</span><span class="p">:</span>                     <span class="o">-</span><span class="mf">6.62307658</span>
<span class="n">Nuclear</span> <span class="n">repulsion</span><span class="p">:</span>            <span class="mf">13.52209655</span>
<span class="n">TOTAL</span><span class="p">:</span>                       <span class="o">-</span><span class="mf">39.72686316</span>

<span class="o">--------------------------------------------------------------------------------</span>
    <span class="n">POSITIONS</span> <span class="n">AND</span> <span class="n">FORCES</span>
<span class="o">--------------------------------------------------------------------------------</span>

<span class="n">C</span>  <span class="o">|</span>   <span class="mf">0.019995</span>   <span class="mf">0.000002</span>   <span class="mf">0.019995</span> <span class="o">|</span> <span class="o">+</span><span class="mf">3.4887e-06</span> <span class="o">+</span><span class="mf">2.7088e-06</span> <span class="o">+</span><span class="mf">3.4885e-06</span>
<span class="n">H</span>  <span class="o">|</span>   <span class="mf">0.645172</span>   <span class="mf">0.625454</span>   <span class="mf">0.645172</span> <span class="o">|</span> <span class="o">-</span><span class="mf">3.0848e-06</span> <span class="o">-</span><span class="mf">5.6713e-06</span> <span class="o">-</span><span class="mf">3.0848e-06</span>
<span class="n">H</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">0.605171</span>  <span class="o">-</span><span class="mf">0.625272</span>   <span class="mf">0.645388</span> <span class="o">|</span> <span class="o">+</span><span class="mf">4.1945e-07</span> <span class="o">-</span><span class="mf">6.8789e-08</span> <span class="o">+</span><span class="mf">2.2218e-06</span>
<span class="n">H</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">0.605385</span>   <span class="mf">0.625087</span>  <span class="o">-</span><span class="mf">0.605385</span> <span class="o">|</span> <span class="o">-</span><span class="mf">3.0450e-06</span> <span class="o">+</span><span class="mf">3.1000e-06</span> <span class="o">-</span><span class="mf">3.0450e-06</span>
<span class="n">H</span>  <span class="o">|</span>   <span class="mf">0.645388</span>  <span class="o">-</span><span class="mf">0.625272</span>  <span class="o">-</span><span class="mf">0.605171</span> <span class="o">|</span> <span class="o">+</span><span class="mf">2.2217e-06</span> <span class="o">-</span><span class="mf">6.8771e-08</span> <span class="o">+</span><span class="mf">4.1955e-07</span>

<span class="n">Elapsed</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.2467</span> <span class="n">s</span>

<span class="o">================================================================================</span>

<span class="o">================================================================================</span>
<span class="n">GEOMETRY</span> <span class="n">OPTIMIZATION</span> <span class="n">STEP</span> <span class="mi">034</span>
<span class="o">================================================================================</span>

<span class="o">--------------------------------------------------------------------------------</span>
    <span class="n">ENERGIES</span>
<span class="o">--------------------------------------------------------------------------------</span>

<span class="n">Kinetic</span><span class="p">:</span>                      <span class="mf">39.46555331</span>
<span class="n">Nuclear</span><span class="p">:</span>                     <span class="o">-</span><span class="mf">118.95690650</span>
<span class="n">Electron</span><span class="o">-</span><span class="n">electron</span> <span class="n">repulsion</span><span class="p">:</span>  <span class="mf">32.86548664</span>
<span class="n">Exchange</span><span class="p">:</span>                     <span class="o">-</span><span class="mf">6.62307497</span>
<span class="n">Nuclear</span> <span class="n">repulsion</span><span class="p">:</span>            <span class="mf">13.52207800</span>
<span class="n">TOTAL</span><span class="p">:</span>                       <span class="o">-</span><span class="mf">39.72686370</span>

<span class="o">--------------------------------------------------------------------------------</span>
    <span class="n">POSITIONS</span> <span class="n">AND</span> <span class="n">FORCES</span>
<span class="o">--------------------------------------------------------------------------------</span>

<span class="n">C</span>  <span class="o">|</span>   <span class="mf">0.019993</span>   <span class="mf">0.000002</span>   <span class="mf">0.019993</span> <span class="o">|</span> <span class="o">+</span><span class="mf">1.1853e-06</span> <span class="o">+</span><span class="mf">1.5988e-06</span> <span class="o">+</span><span class="mf">1.1850e-06</span>
<span class="n">H</span>  <span class="o">|</span>   <span class="mf">0.645174</span>   <span class="mf">0.625454</span>   <span class="mf">0.645174</span> <span class="o">|</span> <span class="o">-</span><span class="mf">1.6340e-06</span> <span class="o">-</span><span class="mf">4.6101e-06</span> <span class="o">-</span><span class="mf">1.6340e-06</span>
<span class="n">H</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">0.605170</span>  <span class="o">-</span><span class="mf">0.625272</span>   <span class="mf">0.645390</span> <span class="o">|</span> <span class="o">+</span><span class="mf">5.5012e-07</span> <span class="o">-</span><span class="mf">1.2756e-07</span> <span class="o">+</span><span class="mf">2.7956e-06</span>
<span class="n">H</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">0.605386</span>   <span class="mf">0.625089</span>  <span class="o">-</span><span class="mf">0.605386</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.8970e-06</span> <span class="o">+</span><span class="mf">3.2663e-06</span> <span class="o">-</span><span class="mf">2.8970e-06</span>
<span class="n">H</span>  <span class="o">|</span>   <span class="mf">0.645390</span>  <span class="o">-</span><span class="mf">0.625272</span>  <span class="o">-</span><span class="mf">0.605170</span> <span class="o">|</span> <span class="o">+</span><span class="mf">2.7956e-06</span> <span class="o">-</span><span class="mf">1.2747e-07</span> <span class="o">+</span><span class="mf">5.5023e-07</span>

<span class="n">Elapsed</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.2813</span> <span class="n">s</span>

<span class="o">================================================================================</span>
</pre></div>
</div>
</section>
<section id="result-dictionary-of-a-geometry-optimization">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Result dictionary of a geometry optimization</a><a class="headerlink" href="#result-dictionary-of-a-geometry-optimization" title="Link to this heading"></a></h2>
<p>The result of a Geometry Optimization calculation is captured inside a dictionary
object. This dictionary objects contains the following keys</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Description of the data contained in the result library</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">res_opt</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">OptimizeResult</span></code> object from the scipy routine. For more information, please consult the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html#scipy.optimize.minimize">documentation</a>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">energies</span></code></p></td>
<td><p>List of the total electronic energy at each ionic step.</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">forces</span></code></p></td>
<td><p>List of the forces on all the atoms at each ionic step.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">coordinates</span></code></p></td>
<td><p>Coordinates of the atoms at each ionic step.</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>Result dictionary of the Hartree-Fock calculation <strong>last</strong> ionic step.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">mol</span></code></p></td>
<td><p>Molecule on which the geometry optimization acted.</p></td>
</tr>
</tbody>
</table>
<p>To demonstrate the use of the above data, consider the script as shown below.
In this script, we generate a CH<sub>4</sub> in a (highly) perturbed configuration.
The perturbed configuration is generated using a random number generator (RNG). For
reproduction purposes, we have seeded this RNG such that the result as shown
below can be easily reproduced. The result of the geometry optimization is
captured in the <code class="code docutils literal notranslate"><span class="pre">res</span></code> variable which is a dictionary according to the
above-mentioned specifications.</p>
<p>To show how the contents of this dictionary can be used, we produce two plots
which are explained below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyqint</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeometryOptimization</span><span class="p">,</span> <span class="n">Molecule</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># seed the random number generator to yield reproducible result</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># build a CH4 molecule where the atom positions are perturbed based on a</span>
<span class="c1"># random number generator</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="o">-</span><span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="o">-</span><span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">mol</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="o">-</span><span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="o">-</span><span class="n">dist</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(),</span>
                  <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>

<span class="c1"># perform the geometry optimization</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">GeometryOptimization</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;sto3g&#39;</span><span class="p">)</span>

<span class="c1"># collect the RMS of the force</span>
<span class="n">rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">])):</span>
    <span class="n">forces</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">rms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">forces</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forces</span><span class="p">))))</span>

<span class="c1"># plot electronic energy and RMS of the force</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">144</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;energies&#39;</span><span class="p">],</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rms</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Root-mean-square force&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration [-]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Electronic energy [Ht]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># show convergence of C-H bond distances for all bonds</span>
<span class="c1"># collect data</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">])))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">])):</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># plot in a figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">144</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H$_{</span><span class="si">%i</span><span class="s1">}$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration [-]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;C-H bond distance [Bohr]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The result of the above script are the following two images, showcasing the
optimization procedure and an example application of the data in the result dictionary.
The first figure shows the total electronic energy and the root-mean-square
of the force as function of the iteration number. The convergence criterion
is essentially such that these forces need to be smaller than a threshold
value. From the figure, it is clear that the total electronic energy converges
faster than the forces.</p>
<figure class="align-default" id="id2">
<img alt="_images/ch4_geomopt_energy_rms_force.png" src="_images/ch4_geomopt_energy_rms_force.png" />
<figcaption>
<p><span class="caption-text">Energy and root-mean-square of the forces as function of the iteration number.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>In the second figure, we can observe the C-H bond distance as function of the
iteration number. Clearly, we start at a relatively unfavorable geometry where
one of the H atoms is quite distanced from the central C atom. With increasing
iteration, we can however readily see that all C-H bond distances converge
to the same value, as expected for the highly symmetric CH<sub>4</sub> molecule.</p>
<figure class="align-default" id="id3">
<img alt="_images/ch4_geomopt_ch_bond.png" src="_images/ch4_geomopt_ch_bond.png" />
<figcaption>
<p><span class="caption-text">C-H bond distances as function of the iteration number.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>It is by no means guaranteed that a geometry optimization converges. Even
more important, when the geometry optimization has not converged, it is
also highly likely that the underlying electronic structure calculation
has not been properly converged as well. One should absolutely distrust
any result coming out of such a calculation.</p>
<p><strong>Always verify that a calculation is properly converged before using
its output.</strong></p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="matrix_visualization.html" class="btn btn-neutral float-left" title="Matrix visualization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="population_analysis.html" class="btn btn-neutral float-right" title="Population Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Inorganic Materials and Catalysis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>